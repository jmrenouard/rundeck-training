# L'identifiant unique du job.
- id: "uuid-windows-backup-restore"
  # Le nom du job.
  name: "Windows - Restauration de fichiers et de répertoires"
  # La description du job.
  description: "Restaure des fichiers et répertoires à partir d'une archive compressée (ZIP) en utilisant PowerShell."
  # Le niveau de log.
  loglevel: INFO
  # Options pour le job.
  options:
    - name: "backup_file"
      description: "Chemin complet de l'archive de sauvegarde à restaurer."
      required: true
    - name: "restore_dir"
      description: "Répertoire de destination pour la restauration."
      required: true
      value: "C:\\RestoredFiles"
  # La définition du workflow.
  sequence:
    # Le workflow s'arrête en cas d'échec.
    keepgoing: false
    # Exécution séquentielle.
    strategy: sequential
    # La liste des commandes.
    commands:
      # Étape 1 : Créer le répertoire de restauration s'il n'existe pas.
      - exec: "powershell -Command New-Item -Path '@option.restore_dir@' -ItemType Directory -Force"
        description: "Création du répertoire de restauration"
      # Étape 2 : Extraire l'archive de sauvegarde.
      - exec: "powershell -Command Expand-Archive -Path '@option.backup_file@' -DestinationPath '@option.restore_dir@' -Force"
        description: "Extraction de l'archive de sauvegarde"
  # Section pour les notifications.
  notification:
    # Notification en cas de succès.
    onsuccess:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Succès de la restauration de fichiers sur ${node.name}"
          message: "La restauration de fichiers depuis '@option.backup_file@' sur le nœud ${node.name} s'est terminée avec succès."
    # Notification en cas d'échec.
    onfailure:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Échec de la restauration de fichiers sur ${node.name}"
          message: "La restauration de fichiers depuis '@option.backup_file@' sur le nœud ${node.name} a échoué."