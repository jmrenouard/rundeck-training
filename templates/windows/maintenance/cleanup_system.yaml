# L'identifiant unique du job.
- id: "uuid-windows-maintenance-cleanup"
  # Le nom du job.
  name: "Windows - Nettoyage du système"
  # La description du job.
  description: "Nettoie les fichiers temporaires et les journaux d'événements sur un système Windows."
  # Le niveau de log.
  loglevel: INFO
  # Options pour le job.
  options:
    - name: "days_to_keep"
      description: "Nombre de jours de fichiers temporaires à conserver."
      required: true
      value: "7"
  # La définition du workflow.
  sequence:
    # Le workflow s'arrête en cas d'échec.
    keepgoing: false
    # Exécution séquentielle.
    strategy: sequential
    # La liste des commandes.
    commands:
      # Étape 1 : Nettoyer les fichiers temporaires du système.
      - exec: "powershell -Command Get-ChildItem -Path $env:TEMP -Recurse | Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-@option.days_to_keep@) } | Remove-Item -Recurse -Force"
        description: "Nettoyage des fichiers temporaires"
      # Étape 2 : Nettoyer les fichiers temporaires de Windows Update.
      - exec: "powershell -Command Remove-Item -Path C:\\Windows\\SoftwareDistribution\\Download\\* -Recurse -Force"
        description: "Nettoyage du cache de Windows Update"
      # Étape 3 : Exécuter l'outil de nettoyage de disque de Windows.
      - exec: "cleanmgr.exe /sagerun:1"
        description: "Exécution de l'outil de nettoyage de disque"
  # Section pour les notifications.
  notification:
    # Notification en cas de succès.
    onsuccess:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Succès du nettoyage système sur ${node.name}"
          message: "Le nettoyage du système sur le nœud ${node.name} s'est terminé avec succès."
    # Notification en cas d'échec.
    onfailure:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Échec du nettoyage système sur ${node.name}"
          message: "Le nettoyage du système sur le nœud ${node.name} a échoué."