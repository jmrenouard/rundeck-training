# L'identifiant unique du job.
- id: "uuid-windows-security-create-user"
  # Le nom du job.
  name: "Windows - Créer un nouvel utilisateur local"
  # La description du job.
  description: "Crée un nouvel utilisateur local sur un système Windows."
  # Le niveau de log.
  loglevel: INFO
  # Options pour le job.
  options:
    - name: "username"
      description: "Nom d'utilisateur à créer."
      required: true
    - name: "password"
      description: "Mot de passe pour le nouvel utilisateur."
      required: true
      secure: true
    - name: "description"
      description: "Description pour le compte utilisateur."
      required: false
  # La définition du workflow.
  sequence:
    # Le workflow s'arrête en cas d'échec.
    keepgoing: false
    # Exécution séquentielle.
    strategy: sequential
    # La liste des commandes.
    commands:
      # Étape 1 : Créer l'utilisateur.
      - exec: "powershell -Command \"New-LocalUser -Name '@option.username@' -Password (ConvertTo-SecureString '@option.password@' -AsPlainText -Force) -Description '@option.description@' -FullName '@option.username@'\""
        description: "Création de l'utilisateur local"
  # Section pour les notifications.
  notification:
    # Notification en cas de succès.
    onsuccess:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Création de l'utilisateur @option.username@ réussie sur ${node.name}"
          message: "L'utilisateur local @option.username@ a été créé avec succès sur le nœud ${node.name}."
    # Notification en cas d'échec.
    onfailure:
      - type: email
        config:
          recipients: "admin@example.com"
          subject: "Échec de la création de l'utilisateur @option.username@ sur ${node.name}"
          message: "La création de l'utilisateur local @option.username@ sur le nœud ${node.name} a échoué."